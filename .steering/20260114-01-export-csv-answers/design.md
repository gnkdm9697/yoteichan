# 回答データCSVエクスポート機能 - 設計

## 実装方針

**クライアントサイド生成**を採用
- APIエンドポイント追加不要
- すでにフロントエンドにデータがあるため効率的
- Blob + URL.createObjectURLでダウンロード

## コンポーネント設計

### 1. CSVダウンロードボタン配置

**配置場所**: `ResponseTable` コンポーネントのヘッダー部分

```
┌──────────────────────────────────────────────┐
│ みんなの回答 (3人)           [CSVダウンロード] │
├──────────────────────────────────────────────┤
│ 日程 | 参加者A | 参加者B | 参加者C | 集計     │
│ ...                                          │
└──────────────────────────────────────────────┘
```

### 2. CSV生成ユーティリティ

**ファイル**: `src/lib/csv.ts`（新規作成）

```typescript
interface CsvExportOptions {
  eventTitle: string;
  dateOptions: DateOption[];
  responses: ResponseData[];
  summary: Record<string, SummaryData>;
}

export function generateResponsesCsv(options: CsvExportOptions): string
export function downloadCsv(content: string, filename: string): void
```

### 3. CSV出力フォーマット

```csv
日程,時間,タイトル,○,△,×,参加者A,参加者B,参加者C
1/8(水),10:00-12:00,,2,0,1,○,○(遅刻します),×
1/9(木),13:00-15:00,午後の部,1,1,1,○,△,×(出張中)
```

**列構成**:
1. 日程（日付+曜日）
2. 時間（開始-終了、または終日）
3. タイトル（同一日複数候補用）
4. ○集計
5. △集計
6. ×集計
7. 参加者1の回答...
8. 参加者Nの回答...

**回答セル形式**:
- OK → `○`
- MAYBE → `△`
- NG → `×`
- メモあり → `○(メモ内容)`
- 未回答 → 空欄

### 4. ファイル仕様

| 項目 | 値 |
|------|-----|
| 文字コード | UTF-8 (BOM: `\uFEFF`) |
| 改行コード | `\r\n` (CRLF) |
| ファイル名 | `{イベントタイトル}_回答一覧.csv` |

## 変更ファイル

| ファイル | 変更内容 |
|----------|----------|
| `src/lib/csv.ts` | **新規作成** - CSV生成・ダウンロードユーティリティ |
| `src/components/features/ResponseTable.tsx` | CSVダウンロードボタン追加、props拡張 |

## シーケンス

```
[ユーザー] → [CSVダウンロードボタンクリック]
                    ↓
           [generateResponsesCsv()]
                    ↓
           [downloadCsv()] → Blob生成 → <a>タグでダウンロード
                    ↓
           [CSVファイルダウンロード完了]
```

## 注意点

1. **特殊文字エスケープ**: カンマ、改行、ダブルクォートを含むセルは適切にクォート
2. **ファイル名サニタイズ**: イベントタイトルからファイル名に使えない文字を除去
3. **空回答**: 回答がない場合は空文字（何も出力しない）
